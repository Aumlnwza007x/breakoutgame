<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Multi-Game Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap');
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
            margin: 0;
            overflow: hidden;
            height: 100vh;
        }
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        canvas {
            background: #000;
            display: block;
            border-radius: 0.5rem;
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.2);
            touch-action: none;
        }
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
        }
        #leaderboardList div {
            background: rgba(255, 255, 255, 0.05);
            margin-bottom: 4px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
        }
    </style>
</head>
<body>

    <!-- SECTION: LOBBY / HOME PAGE -->
    <div id="lobbyView" class="fixed inset-0 flex flex-col items-center justify-center p-6 z-50 bg-slate-900">
        <div class="text-center mb-12">
            <h1 class="text-4xl md:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500 mb-2">MY GAME HUB</h1>
            <p class="text-gray-400 uppercase tracking-widest text-sm">เลือกเกมที่คุณต้องการเล่น</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 w-full max-w-4xl">
            <!-- Game 1: Breakout -->
            <div onclick="switchView('breakout')" class="game-card glass-panel p-8 rounded-2xl cursor-pointer transition-all duration-300 border-t-4 border-blue-500">
                <div class="w-16 h-16 bg-blue-500/20 rounded-lg flex items-center justify-center mb-4">
                    <svg class="w-10 h-10 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </div>
                <h2 class="text-2xl font-bold mb-2">Breakout: Boss Edition</h2>
                <p class="text-gray-400 text-sm mb-4">ทำลายบล็อกและเผชิญหน้ากับบอสสุดโหดพร้อมระบบเลเวล</p>
                <span class="text-blue-400 font-bold flex items-center">เล่นเลย <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></span>
            </div>

            <!-- Game 2: TFT (Placeholder) -->
            <div onclick="switchView('tft')" class="game-card glass-panel p-8 rounded-2xl cursor-pointer transition-all duration-300 border-t-4 border-purple-500 opacity-80">
                <div class="w-16 h-16 bg-purple-500/20 rounded-lg flex items-center justify-center mb-4">
                    <svg class="w-10 h-10 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                </div>
                <h2 class="text-2xl font-bold mb-2">TFT Arena</h2>
                <p class="text-gray-400 text-sm mb-4">จัดทัพฮีโร่และวางกลยุทธ์เพื่อเป็นที่หนึ่งในกระดาน (Coming Soon)</p>
                <span class="text-purple-400 font-bold flex items-center">เร็วๆ นี้</span>
            </div>
        </div>
    </div>

    <!-- SECTION: BREAKOUT GAME VIEW -->
    <div id="breakoutView" class="hidden fixed inset-0 flex flex-col items-center justify-center p-2 bg-slate-950">
        <button onclick="switchView('lobby')" class="absolute top-4 left-4 bg-gray-800 hover:bg-gray-700 p-2 rounded-full text-white transition">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
        </button>

        <div class="flex flex-col items-center space-y-2 max-w-4xl w-full">
            <div class="text-center">
                <h1 class="text-xl md:text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-red-500">Breakout: Boss Evolution</h1>
                <p id="levelIndicator" class="text-[10px] text-gray-500 font-mono uppercase">Level 1</p>
            </div>
            
            <div class="relative w-full flex justify-center">
                <canvas id="gameCanvas" width="800" height="600" class="w-full h-auto max-w-2xl border border-gray-700"></canvas>

                <!-- Start Modal -->
                <div id="startModal" class="absolute inset-0 flex items-center justify-center bg-black/90 rounded-lg z-10 p-4">
                    <div class="bg-gray-800 p-6 rounded-lg shadow-2xl text-center w-full max-w-xs border border-gray-600">
                        <h2 class="text-xl font-bold mb-4">เตรียมตัวให้พร้อม</h2>
                        
                        <div id="leaderboard" class="mb-4 text-left hidden">
                            <p class="text-[10px] text-blue-400 uppercase mb-1 font-bold">Top Players:</p>
                            <div id="leaderboardList"></div>
                        </div>

                        <input type="text" id="nameInput" placeholder="ชื่อของคุณ" class="w-full p-2 rounded bg-gray-700 text-white border border-gray-600 mb-2 text-center text-sm">
                        <select id="difficultySelect" class="w-full p-2 rounded bg-gray-700 text-white border border-gray-600 mb-4 text-sm">
                            <option value="easy">ง่าย</option>
                            <option value="medium" selected>ปานกลาง</option>
                            <option value="hard">ยาก</option>
                        </select>
                        <button id="startButton" class="w-full bg-blue-600 py-2 rounded font-bold hover:bg-blue-500 transition">เริ่มเกม</button>
                    </div>
                </div>

                <!-- Message Box -->
                <div id="messageBox" class="absolute inset-0 hidden items-center justify-center bg-black/80 z-20 p-4">
                    <div class="bg-gray-800 p-6 rounded-lg text-center w-full max-w-xs">
                        <h2 id="messageTitle" class="text-xl font-bold mb-2"></h2>
                        <p id="messageText" class="text-sm mb-4 text-gray-300"></p>
                        <button id="restartButton" class="w-full bg-green-600 py-2 rounded font-bold">ถัดไป</button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 md:flex md:justify-between items-center w-full max-w-2xl px-4 py-2 bg-gray-800/50 rounded-lg border border-gray-700 text-[10px]">
                <div>Name: <span id="playerNameDisplay" class="text-blue-400">-</span></div>
                <div>Score: <span id="scoreDisplay" class="text-white">0</span></div>
                <div>Lives: <span id="livesDisplay" class="text-red-400">3</span></div>
                <div id="bossShieldContainer" class="hidden">Boss Shield: <span id="bossShieldDisplay" class="text-yellow-400">3/3</span></div>
            </div>
        </div>
    </div>

    <!-- SECTION: TFT VIEW (COMING SOON) -->
    <div id="tftView" class="hidden fixed inset-0 flex flex-col items-center justify-center p-6 bg-slate-950">
        <button onclick="switchView('lobby')" class="absolute top-4 left-4 bg-gray-800 hover:bg-gray-700 p-2 rounded-full text-white">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
        </button>
        <div class="text-center">
            <h2 class="text-4xl font-bold mb-4">TFT Arena</h2>
            <p class="text-gray-400">ระบบ Auto Battler กำลังอยู่ในช่วงพัฒนา...</p>
            <div class="mt-8 p-12 glass-panel rounded-3xl border-2 border-dashed border-purple-500/50">
                <p class="text-purple-400 animate-pulse">COMING SOON</p>
            </div>
        </div>
    </div>

    <!-- FIREBASE MODULE -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : { apiKey: "demo-key", projectId: "demo-id" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'boss-evolution-hub';

        let currentUser = null;

        const initAuth = async () => {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }
        };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                loadLeaderboard();
            }
        });
        initAuth();

        function loadLeaderboard() {
            const leaderboardRef = collection(db, 'artifacts', appId, 'public', 'data', 'scores');
            onSnapshot(leaderboardRef, (snapshot) => {
                const scores = [];
                snapshot.forEach(doc => scores.push(doc.data()));
                scores.sort((a, b) => b.score - a.score);
                
                const display = document.getElementById('leaderboardList');
                display.innerHTML = '';
                scores.slice(0, 5).forEach((item, index) => {
                    const div = document.createElement('div');
                    div.className = 'flex justify-between';
                    div.innerHTML = `<span>${index+1}. ${item.name}</span> <span>${item.score}</span>`;
                    display.appendChild(div);
                });
                if (scores.length > 0) document.getElementById('leaderboard').classList.remove('hidden');
            });
        }

        window.saveFinalScore = async (name, finalScore) => {
            if (!currentUser) return;
            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'scores'), {
                    name, score: finalScore, userId: currentUser.uid, timestamp: serverTimestamp()
                });
            } catch (err) { console.error(err); }
        };
    </script>

    <!-- HUB LOGIC -->
    <script>
        function switchView(view) {
            document.getElementById('lobbyView').classList.add('hidden');
            document.getElementById('breakoutView').classList.add('hidden');
            document.getElementById('tftView').classList.add('hidden');

            if (view === 'breakout') {
                document.getElementById('breakoutView').classList.remove('hidden');
            } else if (view === 'tft') {
                document.getElementById('tftView').classList.remove('hidden');
            } else {
                document.getElementById('lobbyView').classList.remove('hidden');
                if (animationId) cancelAnimationFrame(animationId);
                gameActive = false;
            }
        }

        // --- BREAKOUT ENGINE START ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startButton = document.getElementById('startButton');
        const restartButton = document.getElementById('restartButton');
        const startModal = document.getElementById('startModal');
        const messageBox = document.getElementById('messageBox');
        
        let gameActive = false;
        let animationId = null;
        let score = 0, lives = 3, level = 1, playerName = "";
        let paddleX;
        const paddleWidth = 140, paddleHeight = 15, ballRadius = 8;
        let balls = [], bricks = [], difficulty = 'medium';
        let bossMode = false, boss = null, bossProjectiles = [], bossLives = 3, isWinState = false;

        const config = {
            easy: { speed: 4, rows: 3, cols: 6, bossHp: 5 },
            medium: { speed: 6, rows: 4, cols: 8, bossHp: 10 },
            hard: { speed: 8, rows: 5, cols: 10, bossHp: 15 }
        };

        function initBricks() {
            const { rows, cols } = config[difficulty];
            const padding = 10, offsetTop = 80, offsetLeft = 35;
            const bWidth = (canvas.width - (offsetLeft * 2) - (padding * (cols-1))) / cols;
            bricks = [];
            for(let c=0; c<cols; c++) {
                bricks[c] = [];
                for(let r=0; r<rows; r++) { bricks[c][r] = { x: 0, y: 0, status: 1, w: bWidth, h: 25 }; }
            }
        }

        function spawnBoss() {
            bossMode = true;
            const baseHp = config[difficulty].bossHp;
            const currentMaxHp = baseHp + (level * 10); 
            boss = { x: canvas.width / 2 - 75, y: 60, w: 150, h: 50, hp: currentMaxHp, maxHp: currentMaxHp, dx: 3 + (level * 0.8), lastShot: 0 };
            bossProjectiles = []; bossLives = 3; 
            document.getElementById('bossShieldContainer').classList.remove('hidden');
            updateUI();
        }

        function resetGame(fullReset = true) {
            if (animationId) cancelAnimationFrame(animationId);
            if(fullReset) { level = 1; score = 0; playerName = document.getElementById('nameInput').value || "Player"; }
            else { level++; }
            difficulty = document.getElementById('difficultySelect').value;
            lives = 3; bossMode = false; boss = null; bossProjectiles = []; isWinState = false;
            document.getElementById('bossShieldContainer').classList.add('hidden');
            document.getElementById('levelIndicator').innerText = `LEVEL ${level}`;
            document.getElementById('playerNameDisplay').innerText = playerName;
            paddleX = (canvas.width - paddleWidth) / 2;
            balls = [{ x: canvas.width / 2, y: canvas.height - 60, dx: (config[difficulty].speed + (level * 0.3)) * (Math.random() > 0.5 ? 1 : -1), dy: -(config[difficulty].speed + (level * 0.3)) }];
            initBricks(); updateUI(); gameActive = true;
        }

        function updateUI() {
            document.getElementById('scoreDisplay').innerText = score;
            document.getElementById('livesDisplay').innerText = lives;
            document.getElementById('bossShieldDisplay').innerText = bossLives + "/3";
        }

        function handleInput(clientX) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            paddleX = (clientX - rect.left) * scaleX - paddleWidth / 2;
            if(paddleX < 0) paddleX = 0;
            if(paddleX + paddleWidth > canvas.width) paddleX = canvas.width - paddleWidth;
        }

        canvas.addEventListener('mousemove', (e) => handleInput(e.clientX));
        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); handleInput(e.touches[0].clientX); }, { passive: false });
        canvas.addEventListener('touchmove', (e) => { e.preventDefault(); handleInput(e.touches[0].clientX); }, { passive: false });

        function draw() {
            if(!gameActive) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if(!bossMode) {
                let bricksLeft = 0;
                bricks.forEach((col, c) => {
                    col.forEach((b, r) => {
                        if(b.status === 1) {
                            bricksLeft++;
                            b.x = (c * (b.w + 10)) + 35; b.y = (r * (25 + 10)) + 80;
                            ctx.beginPath(); ctx.roundRect(b.x, b.y, b.w, 25, 4);
                            ctx.fillStyle = `hsl(${200 + (r*25)}, 70%, 50%)`; ctx.fill(); ctx.closePath();
                        }
                    });
                });
                if(bricksLeft === 0) spawnBoss();
            } else if(boss) {
                ctx.beginPath(); ctx.roundRect(boss.x, boss.y, boss.w, boss.h, 10);
                ctx.fillStyle = "#ef4444"; ctx.fill(); ctx.strokeStyle = "#fff"; ctx.lineWidth = 3; ctx.stroke(); ctx.closePath();

                const hbW = 300;
                ctx.fillStyle = "#333"; ctx.fillRect(canvas.width/2 - hbW/2, 25, hbW, 15);
                ctx.fillStyle = "#f87171"; ctx.fillRect(canvas.width/2 - hbW/2, 25, (Math.max(0, boss.hp) / boss.maxHp) * hbW, 15);

                boss.x += boss.dx;
                if(boss.x < 0 || boss.x + boss.w > canvas.width) boss.dx = -boss.dx;

                const now = Date.now();
                if(now - boss.lastShot > (1800 - (level * 100))) {
                    bossProjectiles.push({ x: boss.x + boss.w/2, y: boss.y + boss.h, dy: 5 + (level * 0.4) });
                    boss.lastShot = now;
                }

                bossProjectiles.forEach((p, pi) => {
                    ctx.beginPath(); ctx.arc(p.x, p.y, 10, 0, Math.PI*2); ctx.fillStyle = "#fbbf24"; ctx.fill(); ctx.closePath();
                    p.y += p.dy;
                    if(p.y > canvas.height - paddleHeight - 25 && p.x > paddleX && p.x < paddleX + paddleWidth) {
                        bossProjectiles.splice(pi, 1); bossLives--; updateUI();
                        if(bossLives <= 0) endGame("คุณพ่ายแพ้!", "เกราะป้องกันพังทลาย!", false);
                    }
                    if(p.y > canvas.height) bossProjectiles.splice(pi, 1);
                });
                if (boss.hp <= 0) { boss = null; endGame("บอสพ่ายแพ้!", "เตรียมพร้อมเลเวลถัดไป", true); }
            }

            ctx.beginPath(); ctx.roundRect(paddleX, canvas.height - paddleHeight - 20, paddleWidth, paddleHeight, 8);
            ctx.fillStyle = "#3b82f6"; ctx.fill(); ctx.closePath();

            balls.forEach((ball) => {
                ctx.beginPath(); ctx.arc(ball.x, ball.y, ballRadius, 0, Math.PI*2); ctx.fillStyle = "#FFF"; ctx.fill(); ctx.closePath();
                if(ball.x + ball.dx > canvas.width - ballRadius || ball.x + ball.dx < ballRadius) ball.dx = -ball.dx;
                if(ball.y + ball.dy < ballRadius) ball.dy = -ball.dy;

                if(ball.y + ball.dy > canvas.height - paddleHeight - 35) {
                    if(ball.x > paddleX && ball.x < paddleX + paddleWidth) {
                        ball.dy = -Math.abs(ball.dy);
                        let hitPoint = (ball.x - (paddleX + paddleWidth/2)) / (paddleWidth/2);
                        ball.dx = hitPoint * (config[difficulty].speed + (level * 0.4));
                    } else if (ball.y > canvas.height) {
                        lives--; updateUI();
                        if(lives <= 0) endGame("GAME OVER", "เลเวล: " + level, false);
                        else { ball.x = canvas.width / 2; ball.y = canvas.height - 60; ball.dy = -(config[difficulty].speed + (level * 0.4)); }
                    }
                }

                if(!bossMode) {
                    bricks.forEach(col => col.forEach(b => {
                        if(b.status === 1 && ball.x > b.x && ball.x < b.x + b.w && ball.y > b.y && ball.y < b.y + b.h) {
                            ball.dy = -ball.dy; b.status = 0; score += 10; updateUI();
                        }
                    }));
                } else if(boss) {
                    if(ball.x > boss.x && ball.x < boss.x + boss.w && ball.y > boss.y && ball.y < boss.y + boss.h) {
                        ball.dy = -ball.dy; boss.hp -= 1; score += 50; updateUI();
                    }
                }
                ball.x += ball.dx; ball.y += ball.dy;
            });
            animationId = requestAnimationFrame(draw);
        }

        function endGame(title, text, win) {
            gameActive = false; if (animationId) cancelAnimationFrame(animationId);
            isWinState = win; document.getElementById('messageTitle').innerText = title;
            document.getElementById('messageText').innerText = `${text} | Score: ${score}`;
            messageBox.classList.remove('hidden'); messageBox.classList.add('flex');
            if (!win && score > 0 && window.saveFinalScore) window.saveFinalScore(playerName, score);
            restartButton.innerText = win ? "เลเวลถัดไป" : "เริ่มใหม่";
        }

        startButton.onclick = () => { startModal.classList.add('hidden'); resetGame(true); draw(); };
        restartButton.onclick = () => {
            messageBox.classList.add('hidden'); messageBox.classList.remove('flex');
            if(isWinState) { resetGame(false); draw(); } else { startModal.classList.remove('hidden'); }
        };
        // --- BREAKOUT ENGINE END ---

    </script>
</body>
</html>
