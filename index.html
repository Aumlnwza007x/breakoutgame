<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AUM HUB - Breakout & Tactical Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700&display=swap');
        body { 
            font-family: 'Sarabun', sans-serif; 
            background-color: #0f172a; 
            color: #e2e8f0; 
            margin: 0; 
            overflow: hidden;
            touch-action: manipulation;
        }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        
        /* TFT Layout */
        .tft-container { display: flex; flex-direction: column; align-items: center; gap: 20px; padding: 20px; }
        .board-row { display: flex; gap: 15px; }
        .row-offset { margin-left: 45px; }

        .hex-cell {
            width: 70px; height: 70px;
            border: 2px dashed rgba(255,255,255,0.1);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s;
        }

        .unit {
            width: 60px; height: 60px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; cursor: grab; z-index: 10;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            font-size: 1.5rem;
            user-select: none;
            transition: transform 0.1s;
        }
        .unit:active { cursor: grabbing; }
        .cost-1 { background: linear-gradient(135deg, #64748b, #475569); border: 3px solid #94a3b8; }
        .cost-2 { background: linear-gradient(135deg, #16a34a, #15803d); border: 3px solid #4ade80; }
        .cost-3 { background: linear-gradient(135deg, #2563eb, #1d4ed8); border: 3px solid #60a5fa; }

        .bench-slot {
            width: 60px; height: 60px;
            border-radius: 12px;
            background: rgba(51, 65, 85, 0.4);
            border: 1px solid rgba(255,255,255,0.1);
            display: flex; align-items: center; justify-content: center;
        }

        .shop-card {
            background: #1e293b;
            border-radius: 12px;
            padding: 10px;
            cursor: pointer;
            border: 1px solid transparent;
            text-align: center;
            transition: all 0.2s;
        }
        .shop-card:hover { border-color: #3b82f6; background: #334155; }
        .shop-card.cost-1-border { border-bottom: 4px solid #94a3b8; }
        .shop-card.cost-2-border { border-bottom: 4px solid #22c55e; }
        .shop-card.cost-3-border { border-bottom: 4px solid #3b82f6; }

        .dragging { opacity: 0.8; transform: scale(1.2); pointer-events: none; position: fixed; z-index: 1000; }
        
        canvas#gameCanvas {
            background: #000; display: block; border-radius: 0.5rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5); touch-action: none;
        }

        #sellZone.drag-over { background-color: rgba(239, 68, 68, 0.4); border-color: #ef4444; transform: scale(1.05); }
    </style>
</head>
<body>

    <nav class="p-3 flex justify-between items-center glass sticky top-0 z-[100]">
        <div class="flex items-center gap-2 cursor-pointer" onclick="showView('home')">
            <div class="w-8 h-8 bg-blue-600 rounded flex items-center justify-center shadow-lg shadow-blue-500/50">
                <i class="fas fa-cubes text-white text-xs"></i>
            </div>
            <h1 class="text-lg font-bold uppercase tracking-tighter">AUM<span class="text-blue-500">HUB</span></h1>
        </div>
        <div class="flex gap-4">
            <button onclick="showView('home')" class="text-xs uppercase font-bold text-slate-400 hover:text-white transition">Home</button>
            <button onclick="showView('breakout')" class="text-xs uppercase font-bold text-slate-400 hover:text-white transition">Breakout</button>
            <button onclick="showView('tft')" class="text-xs uppercase font-bold text-slate-400 hover:text-white transition">TFT Mode</button>
        </div>
    </nav>

    <!-- VIEW: HOME -->
    <main id="view-home" class="view-section container mx-auto px-6 py-12 h-screen overflow-y-auto">
        <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto pt-10">
            <div onclick="showView('breakout')" class="glass p-10 rounded-3xl border-2 border-blue-500/20 hover:border-blue-500/60 transition-all cursor-pointer group hover:-translate-y-2 flex flex-col items-center text-center">
                <div class="w-20 h-20 bg-blue-500/20 rounded-2xl flex items-center justify-center mb-6">
                    <i class="fas fa-th text-blue-500 text-4xl"></i>
                </div>
                <h3 class="text-2xl font-bold">Breakout: Boss Evolution</h3>
            </div>
            <div onclick="showView('tft')" class="glass p-10 rounded-3xl border-2 border-purple-500/20 hover:border-purple-500/60 transition-all cursor-pointer group hover:-translate-y-2 flex flex-col items-center text-center">
                <div class="w-20 h-20 bg-purple-500/20 rounded-2xl flex items-center justify-center mb-6">
                    <i class="fas fa-chess-board text-purple-500 text-4xl"></i>
                </div>
                <h3 class="text-2xl font-bold">Tactical Online (TFT)</h3>
            </div>
        </div>
    </main>

    <!-- VIEW: BREAKOUT -->
    <main id="view-breakout" class="view-section hidden flex flex-col items-center p-2 h-screen overflow-y-auto">
        <div class="flex flex-col items-center space-y-2 max-w-4xl w-full py-4">
            <div class="text-center">
                <h1 class="text-2xl md:text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-red-500">Breakout: Boss Evolution</h1>
                <p id="levelIndicator" class="text-xs md:text-sm text-gray-400 font-mono uppercase">Level 1</p>
            </div>
            
            <div class="relative w-full flex justify-center">
                <canvas id="gameCanvas" width="800" height="600" class="w-full h-auto max-w-3xl border border-gray-700"></canvas>
                <div id="startModal" class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-80 rounded-lg z-10 p-4">
                    <div class="bg-gray-800 p-6 md:p-8 rounded-lg shadow-2xl text-center w-full max-w-sm border border-gray-600">
                        <h2 class="text-2xl md:text-3xl font-bold mb-4 text-white">‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°</h2>
                        <input type="text" id="nameInput" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" class="w-full p-3 rounded-md bg-gray-700 text-white border border-gray-600 focus:outline-none focus:border-blue-500 mb-4 text-center">
                        <select id="difficultySelect" class="w-full p-3 rounded-md bg-gray-700 text-white border border-gray-600 mb-6 cursor-pointer">
                            <option value="easy">‡∏á‡πà‡∏≤‡∏¢ (Easy)</option>
                            <option value="medium" selected>‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (Medium)</option>
                            <option value="hard">‡∏¢‡∏≤‡∏Å (Hard)</option>
                        </select>
                        <button id="startButton" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-md">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
                    </div>
                </div>
                <div id="messageBox" class="absolute inset-0 hidden items-center justify-center bg-black bg-opacity-80 rounded-lg z-20 p-4">
                    <div class="bg-gray-800 p-6 md:p-8 rounded-lg shadow-2xl text-center w-full max-w-sm border border-gray-600">
                        <h2 id="messageTitle" class="text-2xl md:text-3xl font-bold mb-2 text-white"></h2>
                        <p id="messageText" class="text-lg mb-6 text-gray-300"></p>
                        <button id="restartButton" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-md">‡∏ï‡∏Å‡∏•‡∏á</button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 md:flex md:justify-between items-center w-full max-w-3xl px-4 py-2 bg-gray-800 rounded-lg border border-gray-700 gap-2">
                <div class="text-[10px] md:text-sm uppercase tracking-widest text-gray-400">Name: <span id="playerNameDisplay" class="text-blue-400 font-bold">-</span></div>
                <div class="text-[10px] md:text-sm uppercase tracking-widest text-gray-400">Score: <span id="scoreDisplay" class="text-white font-bold">0</span></div>
                <div class="text-[10px] md:text-sm uppercase tracking-widest text-gray-400">Lives: <span id="livesDisplay" class="text-red-400 font-bold">3</span></div>
                <div id="bossShieldContainer" class="text-[10px] md:text-sm uppercase tracking-widest text-gray-400 hidden">Boss Shield: <span id="bossShieldDisplay" class="text-yellow-400 font-bold">3/3</span></div>
            </div>
        </div>
    </main>

    <!-- VIEW: TFT -->
    <main id="view-tft" class="view-section hidden flex flex-col h-screen overflow-hidden">
        <div class="flex-1 p-4 flex flex-col items-center justify-center overflow-y-auto">
            <div class="flex items-center gap-4 mb-6">
                <div class="bg-yellow-500/20 border border-yellow-500/50 px-6 py-2 rounded-2xl flex items-center gap-3">
                    <i class="fas fa-coins text-yellow-400"></i>
                    <span id="goldVal" class="text-2xl font-black text-yellow-400">20</span>
                </div>
            </div>

            <div class="tft-container mb-8">
                <div class="board-row" id="board-row-1"></div>
                <div class="board-row row-offset" id="board-row-2"></div>
            </div>
            
            <div class="w-full max-w-xl">
                <div class="text-[10px] text-slate-500 uppercase font-bold mb-2 text-center">‡∏™‡∏≥‡∏£‡∏≠‡∏á (Bench)</div>
                <div class="flex gap-2 justify-center bg-slate-900/50 p-4 rounded-3xl border border-white/5" id="bench"></div>
            </div>
        </div>

        <div class="glass p-6 rounded-t-[40px] border-t border-blue-500/30">
            <div class="max-w-4xl mx-auto">
                <div class="flex justify-between items-center mb-4">
                    <button onclick="rerollShop()" class="bg-blue-600 hover:bg-blue-700 px-8 py-2 rounded-2xl text-sm font-bold shadow-lg shadow-blue-500/20">
                        <i class="fas fa-sync-alt mr-2"></i> REROLL (2G)
                    </button>
                    <div id="sellZone" ondragover="handleDragOverSell(event)" ondragleave="handleDragLeaveSell(event)" ondrop="handleDropSell(event)" class="bg-red-500/10 border-2 border-dashed border-red-500/30 text-red-500 px-10 py-3 rounded-2xl text-sm font-bold transition-all duration-200">
                        <i class="fas fa-trash-alt mr-2"></i> ‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏≤‡∏¢
                    </div>
                </div>
                <div class="grid grid-cols-5 gap-3" id="shop"></div>
            </div>
        </div>
    </main>

    <script>
        // --- CORE UI ---
        window.showView = (viewId) => {
            document.querySelectorAll('.view-section').forEach(v => v.classList.add('hidden'));
            document.getElementById('view-' + viewId).classList.remove('hidden');
            if(viewId === 'tft') initTFT();
        };

        // --- BREAKOUT GAME LOGIC ---
        (function() {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const startButton = document.getElementById('startButton');
            const restartButton = document.getElementById('restartButton');
            const startModal = document.getElementById('startModal');
            const messageBox = document.getElementById('messageBox');
            let gameActive = false, animationId = null, score = 0, lives = 3, level = 1, paddleX;
            const paddleWidth = 140, paddleHeight = 15, ballRadius = 8;
            let balls = [], bricks = [], difficulty = 'medium', bossMode = false, boss = null, bossProjectiles = [], bossLives = 3, isWinState = false;
            const config = { easy: { speed: 4, rows: 3, cols: 6, bossHp: 5 }, medium: { speed: 6, rows: 4, cols: 8, bossHp: 10 }, hard: { speed: 8, rows: 5, cols: 10, bossHp: 15 } };

            function initBricks() {
                const { rows, cols } = config[difficulty];
                const padding = 10, offsetTop = 80, offsetLeft = 35;
                const bWidth = (canvas.width - (offsetLeft * 2) - (padding * (cols-1))) / cols;
                bricks = [];
                for(let c=0; c<cols; c++) {
                    bricks[c] = [];
                    for(let r=0; r<rows; r++) bricks[c][r] = { x: 0, y: 0, status: 1, w: bWidth, h: 25 };
                }
            }

            function resetGame(fullReset = true) {
                if (animationId) cancelAnimationFrame(animationId);
                if(fullReset) { level = 1; score = 0; } else level++;
                difficulty = document.getElementById('difficultySelect').value;
                const settings = config[difficulty];
                lives = 3; bossMode = false; boss = null; bossProjectiles = []; isWinState = false;
                document.getElementById('bossShieldContainer').classList.add('hidden');
                document.getElementById('levelIndicator').innerText = `LEVEL ${level}`;
                document.getElementById('playerNameDisplay').innerText = document.getElementById('nameInput').value || "Player";
                paddleX = (canvas.width - paddleWidth) / 2;
                balls = [{ x: canvas.width / 2, y: canvas.height - 60, dx: (settings.speed + (level * 0.3)) * (Math.random() > 0.5 ? 1 : -1), dy: -(settings.speed + (level * 0.3)) }];
                initBricks(); updateUI(); gameActive = true;
            }

            function updateUI() {
                document.getElementById('scoreDisplay').innerText = score;
                document.getElementById('livesDisplay').innerText = lives;
                document.getElementById('bossShieldDisplay').innerText = bossLives + "/3";
            }

            function handleInput(clientX) {
                const rect = canvas.getBoundingClientRect();
                paddleX = (clientX - rect.left) * (canvas.width / rect.width) - paddleWidth / 2;
                if(paddleX < 0) paddleX = 0; if(paddleX + paddleWidth > canvas.width) paddleX = canvas.width - paddleWidth;
            }

            canvas.addEventListener('mousemove', (e) => handleInput(e.clientX));
            canvas.addEventListener('touchmove', (e) => { e.preventDefault(); handleInput(e.touches[0].clientX); }, { passive: false });

            window.drawBreakout = function() {
                if(!gameActive) return;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                if(!bossMode) {
                    let bricksLeft = 0;
                    bricks.forEach((col, c) => col.forEach((b, r) => {
                        if(b.status === 1) {
                            bricksLeft++; b.x = (c * (b.w + 10)) + 35; b.y = (r * (b.h + 10)) + 80;
                            ctx.beginPath(); ctx.roundRect(b.x, b.y, b.w, b.h, 4); ctx.fillStyle = `hsl(${200 + (r*25)}, 70%, 50%)`; ctx.fill(); ctx.closePath();
                        }
                    }));
                    if(bricksLeft === 0) { bossMode = true; boss = { x: canvas.width / 2 - 75, y: 60, w: 150, h: 50, hp: config[difficulty].bossHp + (level * 10), maxHp: config[difficulty].bossHp + (level * 10), dx: 3 + (level * 0.8), lastShot: 0 }; document.getElementById('bossShieldContainer').classList.remove('hidden'); }
                } else if(boss) {
                    ctx.beginPath(); ctx.roundRect(boss.x, boss.y, boss.w, boss.h, 10); ctx.fillStyle = "#ef4444"; ctx.fill(); ctx.closePath();
                    ctx.fillStyle = "#333"; ctx.fillRect(canvas.width/2 - 150, 25, 300, 20);
                    ctx.fillStyle = "#f87171"; ctx.fillRect(canvas.width/2 - 150, 25, (Math.max(0, boss.hp) / boss.maxHp) * 300, 20);
                    boss.x += boss.dx; if(boss.x < 0 || boss.x + boss.w > canvas.width) boss.dx = -boss.dx;
                    if(Date.now() - boss.lastShot > (1800 - (level * 100))) { bossProjectiles.push({ x: boss.x + boss.w/2, y: boss.y + boss.h, dy: 5 + (level * 0.4) }); boss.lastShot = Date.now(); }
                    bossProjectiles.forEach((p, pi) => {
                        ctx.beginPath(); ctx.arc(p.x, p.y, 10, 0, Math.PI*2); ctx.fillStyle = "#fbbf24"; ctx.fill(); ctx.closePath(); p.y += p.dy;
                        if(p.y > canvas.height - paddleHeight - 25 && p.x > paddleX && p.x < paddleX + paddleWidth) { bossProjectiles.splice(pi, 1); bossLives--; updateUI(); if(bossLives <= 0) endGame("‡∏û‡πà‡∏≤‡∏¢‡πÅ‡∏û‡πâ", "‡πÄ‡∏Å‡∏£‡∏≤‡∏∞‡∏û‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß", false); }
                        if(p.y > canvas.height) bossProjectiles.splice(pi, 1);
                    });
                }
                ctx.beginPath(); ctx.roundRect(paddleX, canvas.height - paddleHeight - 20, paddleWidth, paddleHeight, 8); ctx.fillStyle = "#3b82f6"; ctx.fill(); ctx.closePath();
                balls.forEach((ball, bi) => {
                    ctx.beginPath(); ctx.arc(ball.x, ball.y, ballRadius, 0, Math.PI*2); ctx.fillStyle = "#FFF"; ctx.fill(); ctx.closePath();
                    if(ball.x + ball.dx > canvas.width - ballRadius || ball.x + ball.dx < ballRadius) ball.dx = -ball.dx;
                    if(ball.y + ball.dy < ballRadius) ball.dy = -ball.dy;
                    if(ball.y + ball.dy > canvas.height - paddleHeight - 35) {
                        if(ball.x > paddleX && ball.x < paddleX + paddleWidth) { ball.dy = -Math.abs(ball.dy); ball.dx = ((ball.x - (paddleX + paddleWidth/2)) / (paddleWidth/2)) * (config[difficulty].speed + (level * 0.4)); }
                        else if (ball.y > canvas.height) { lives--; updateUI(); if(lives <= 0) endGame("GAME OVER", "‡πÄ‡∏•‡πÄ‡∏ß‡∏•: " + level, false); else { ball.x = canvas.width/2; ball.y = canvas.height-60; ball.dy = -(config[difficulty].speed + (level*0.4)); } }
                    }
                    if(!bossMode) bricks.forEach(col => col.forEach(b => { if(b.status === 1 && ball.x > b.x && ball.x < b.x + b.w && ball.y > b.y && ball.y < b.y + b.h) { ball.dy = -ball.dy; b.status = 0; score += 10; updateUI(); } }));
                    else if(boss && ball.x > boss.x && ball.x < boss.x + boss.w && ball.y > boss.y && ball.y < boss.y + boss.h) { ball.dy = -ball.dy; boss.hp -= 1; score += 50; updateUI(); if(boss.hp <= 0) endGame("‡∏ä‡∏ô‡∏∞‡∏ö‡∏≠‡∏™!", "‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ü‡∏∑‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡πâ‡∏ß", true); }
                    ball.x += ball.dx; ball.y += ball.dy;
                });
                animationId = requestAnimationFrame(drawBreakout);
            }

            function endGame(title, text, win) { gameActive = false; if (animationId) cancelAnimationFrame(animationId); isWinState = win; document.getElementById('messageTitle').innerText = title; document.getElementById('messageText').innerText = `${text} | ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${score}`; messageBox.classList.remove('hidden'); messageBox.classList.add('flex'); restartButton.innerText = win ? "‡∏ï‡πà‡∏≠‡πÑ‡∏õ" : "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà"; }
            startButton.onclick = () => { startModal.classList.add('hidden'); resetGame(true); drawBreakout(); };
            restartButton.onclick = () => { messageBox.classList.add('hidden'); messageBox.classList.remove('flex'); if(isWinState) { resetGame(false); drawBreakout(); } else startModal.classList.remove('hidden'); };
        })();

        // --- TFT LOGIC (Tactical Online) ---
        let gold = 20, tftBoard = Array(10).fill(null), tftBench = Array(8).fill(null), dragSource = null, dragIdx = null, ghost = null;
        const unitPool = [{ name: "üõ°Ô∏è", cost: 1, type: "Tank" }, { name: "‚öîÔ∏è", cost: 1, type: "Warrior" }, { name: "üèπ", cost: 2, type: "Archer" }, { name: "üßô", cost: 2, type: "Mage" }, { name: "üê≤", cost: 3, type: "Dragon" }];

        function initTFT() { renderTFTBoard(); renderTFTBench(); rerollShop(true); updateGold(0); }

        function renderTFTBoard() {
            const r1 = document.getElementById('board-row-1'), r2 = document.getElementById('board-row-2');
            r1.innerHTML = ''; r2.innerHTML = '';
            for(let i=0; i<10; i++) {
                const u = tftBoard[i], html = `<div class="hex-cell" data-type="board" data-idx="${i}" ondragover="event.preventDefault()" ondrop="handleDrop(event)">${u ? `<div class="unit cost-${u.cost}" draggable="true" ondragstart="handleDragStart(event, 'board', ${i})" ontouchstart="handleTouchStart(event, 'board', ${i})">${u.name}</div>` : ''}</div>`;
                if(i < 5) r1.innerHTML += html; else r2.innerHTML += html;
            }
        }

        function renderTFTBench() {
            document.getElementById('bench').innerHTML = tftBench.map((u, i) => `<div class="bench-slot" data-type="bench" data-idx="${i}" ondragover="event.preventDefault()" ondrop="handleDrop(event)">${u ? `<div class="unit cost-${u.cost}" draggable="true" ondragstart="handleDragStart(event, 'bench', ${i})" ontouchstart="handleTouchStart(event, 'bench', ${i})">${u.name}</div>` : ''}</div>`).join('');
        }

        window.rerollShop = (free = false) => {
            if(!free && gold < 2) return; if(!free) updateGold(-2);
            const shopEl = document.getElementById('shop'); shopEl.innerHTML = '';
            for(let i=0; i<5; i++){
                const u = unitPool[Math.floor(Math.random()*unitPool.length)];
                const card = document.createElement('div'); card.className = `shop-card cost-${u.cost}-border`;
                card.innerHTML = `<div class="text-3xl mb-1">${u.name}</div><div class="text-[10px] text-slate-400 font-bold uppercase">${u.type}</div><div class="text-yellow-500 font-bold">$${u.cost}</div>`;
                card.onclick = () => { const bIdx = tftBench.indexOf(null); if(gold >= u.cost && bIdx !== -1) { updateGold(-u.cost); tftBench[bIdx] = {...u}; card.style.opacity = '0.2'; card.onclick = null; renderTFTBench(); } };
                shopEl.appendChild(card);
            }
        };

        function updateGold(n) { gold += n; document.getElementById('goldVal').innerText = gold; }

        // --- Drag & Drop Fixes ---
        window.handleDragStart = (e, s, i) => { dragSource = s; dragIdx = i; e.dataTransfer.setData("text", "dragging"); };
        window.handleDragOverSell = (e) => { e.preventDefault(); document.getElementById('sellZone').classList.add('drag-over'); };
        window.handleDragLeaveSell = (e) => { document.getElementById('sellZone').classList.remove('drag-over'); };
        window.handleDropSell = (e) => { e.preventDefault(); sell(dragSource, dragIdx); document.getElementById('sellZone').classList.remove('drag-over'); };
        window.handleDrop = (e) => { const dest = e.currentTarget.dataset.type, dIdx = e.currentTarget.dataset.idx; executeMove(dragSource, dragIdx, dest, dIdx); };

        window.handleTouchStart = (e, s, i) => {
            const touch = e.touches[0], uData = (s === 'board' ? tftBoard[i] : tftBench[i]);
            if(!uData) return;
            dragSource = s; dragIdx = i;
            ghost = document.createElement('div'); ghost.className = `unit cost-${uData.cost} dragging`; ghost.innerText = uData.name; document.body.appendChild(ghost);
            const move = (me) => {
                const tx = me.touches[0].clientX, ty = me.touches[0].clientY;
                ghost.style.left = tx-30+'px'; ghost.style.top = ty-30+'px';
                const sellZone = document.getElementById('sellZone');
                const sellRect = sellZone.getBoundingClientRect();
                if(tx > sellRect.left && tx < sellRect.right && ty > sellRect.top && ty < sellRect.bottom) sellZone.classList.add('drag-over');
                else sellZone.classList.remove('drag-over');
            };
            const end = (ee) => {
                const ex = ee.changedTouches[0].clientX, ey = ee.changedTouches[0].clientY;
                const sellZone = document.getElementById('sellZone');
                const sellRect = sellZone.getBoundingClientRect();
                if(ex > sellRect.left && ex < sellRect.right && ey > sellRect.top && ey < sellRect.bottom) { sell(s, i); } 
                else {
                    const dropZone = document.elementFromPoint(ex, ey)?.closest('[data-type]');
                    if(dropZone) executeMove(s, i, dropZone.dataset.type, dropZone.dataset.idx);
                }
                ghost.remove(); sellZone.classList.remove('drag-over');
                document.removeEventListener('touchmove', move); document.removeEventListener('touchend', end);
            };
            document.addEventListener('touchmove', move); document.addEventListener('touchend', end);
        };

        function executeMove(s, si, d, di) {
            if(si === null) return;
            let u = (s==='board'?tftBoard[si]:tftBench[si]);
            if(!u) return;
            if(s==='board') tftBoard[si]=null; else tftBench[si]=null;
            let targetArr = (d==='board'?tftBoard:tftBench);
            let prev = targetArr[di];
            targetArr[di] = u;
            if(prev) { if(s==='board') tftBoard[si]=prev; else tftBench[si]=prev; }
            renderTFTBoard(); renderTFTBench();
        }

        function sell(s, i) {
            if(i === null) return;
            const u = (s==='board'?tftBoard[i]:tftBench[i]);
            if(u){ updateGold(u.cost); if(s==='board') tftBoard[i]=null; else tftBench[i]=null; renderTFTBoard(); renderTFTBench(); }
        }

        window.onload = () => showView('home');
    </script>
</body>
</html>
